<html>
    <head></head>
    <body>
        Test
        <div id="container"></div>
        <div id="result"></div>
        <div id="error-log" style="white-space: pre-wrap; color: red;"></div>
    </body>
    <script>
    const script = document.createElement("script");
    script.src = "https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback";
    script.async = true;
    script.defer = true;
    document.getElementById("result").innerHTML = `Loading Turnstile script.`;
    script.onerror = function () {
     document.getElementById("result").innerHTML = `Failed to load Turnstile script.`;
    };
     script.onload  = function () {
     document.getElementById("result").innerHTML = `v4 Loaded.`;
     window.onloadTurnstileCallback = function () {
    try {
        turnstile.render("#container", {
            sitekey: "0x4AAAAAABnXznZ59blJHWDb",
            callback: function (token) {
                console.log(`Challenge Success ${token}`);
                document.getElementById("result").innerHTML = `v4 Token: ${token}`;
            },
        });
    } catch (error) {
                document.getElementById("result").innerHTML = `Error`;
    }
};
    };

    document.head.appendChild(script);
    </script>
    <script>
        (function () {
            const logDiv = document.getElementById('log-errors');

            function logToPage(type, msg) {
                const entry = `[${type.toUpperCase()}] ${msg}\n`;
                logDiv.textContent += entry;
            }

            // Override console methods
            ['log', 'warn', 'error'].forEach(method => {
                const original = console[method];
                console[method] = function (...args) {
                    logToPage(method, args.map(a => typeof a === 'object' ? JSON.stringify(a) : a).join(' '));
                    original.apply(console, args);
                };
            });

            // Catch uncaught errors
            window.onerror = function (msg, url, line, col, err) {
                const stack = err && err.stack ? `\nStack: ${err.stack}` : '';
                logToPage("onerror", `${msg} at ${url}:${line}:${col}${stack}`);
                return false;
            };

            // Catch unhandled Promise rejections
            window.addEventListener("unhandledrejection", function (event) {
                logToPage("unhandledrejection", `${event.reason}`);
            });
        })();
    </script>
</html>
